<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>4kSend</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="upload.css">
  <link rel="stylesheet" href="preview-modal.css">
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
</head>
<body>
<div class="container">
  <div style="text-align: center;margin-bottom: 30px;"><img src="../images/logo.png" style="width: 20%;"></div>

  <!-- 템플릿 설정 영역 -->
  <div class="section">
    <div class="section-title">템플릿 설정</div>
    <form id="templateForm">
      <div class="template-load-link-wrapper">
        <span class="template-load-link" onclick="loadRecentTemplate()">
          <span class="load-icon">⌛</span>
          최근 템플릿 불러오기
        </span>
      </div>

      <label for="subject">제목</label>
      <div class="template-element">
        <input type="text" id="subject" placeholder="메일 제목">
      </div>

      <label for="body" class="template-element">본문</label>
      <div class="template-variables">
        <span class="variable-label">템플릿 변수:</span>
        <button type="button" class="variable-btn" onclick="insertVariable('이름')">이름</button>
        <button type="button" class="variable-btn" onclick="insertVariable('티켓번호')">티켓번호</button>
        <button type="button" class="variable-btn" onclick="insertVariable('티켓매수')">티켓매수</button>
      </div>
      <div id="editor" style="min-height: 200px; background:#fff; border:2px solid #e2e8f0; border-radius:12px; margin-bottom: 20px">
        <textarea id="body" name="body" style="display:none;"></textarea>
      </div>

      <label for="template-file">파일</label>
      <div class="file-upload" id="template-file">
        <input type="file" id="templateFileInput" name="templateFile" accept=".jpeg,.jpg,.png,pdf">
        <label for="templateFileInput" class="file-upload-label">
          <div class="file-upload-icon">📁</div>
          <div class="file-upload-text">
            파일을 선택<br>
            <small>(.pdf, .jpeg, .jpg, .png 파일만 지원)</small>
          </div>
        </label>
      </div>

      <div class="button-group">
        <button type="submit" class="btn-primary">템플릿 설정</button>
      </div>
    </form>
    <div id="template-result" style="margin-top: 20px;"></div>
  </div>

  <!-- 파일 업로드 및 메일 발송 영역 -->
  <div class="section">
    <div class="section-title">메일 발송</div>
    <form id="uploadForm">
      <!-- 열 선택 섹션 -->
      <div class="section">
        <div class="column-selector">
          <div class="selector-row">
            <label class="selector-label">이름:</label>
            <select class="column-select" id="nameColumn">
              <option value="0">A열</option>
              <option value="1">B열</option>
              <option value="2" selected>C열</option>
              <option value="3">D열</option>
              <option value="4">E열</option>
              <option value="5">F열</option>
              <option value="6">G열</option>
              <option value="7">H열</option>
            </select>
          </div>

          <div class="selector-row">
            <label class="selector-label">이메일:</label>
            <select class="column-select" id="emailColumn">
              <option value="0">A열</option>
              <option value="1" selected>B열</option>
              <option value="2">C열</option>
              <option value="3">D열</option>
              <option value="4">E열</option>
              <option value="5">F열</option>
              <option value="6">G열</option>
              <option value="7">H열</option>
            </select>
          </div>

          <div class="selector-row">
            <label class="selector-label">티켓번호:</label>
            <select class="column-select" id="ticketColumn">
              <option value="0">A열</option>
              <option value="1">B열</option>
              <option value="2">C열</option>
              <option value="3" selected>D열</option>
              <option value="4">E열</option>
              <option value="5">F열</option>
              <option value="6">G열</option>
              <option value="7">H열</option>
            </select>
          </div>
        </div>
      </div>
      <div class="file-upload">
        <input type="file" id="fileInput" name="file" accept=".xls,.xlsx" required>
        <label for="fileInput" class="file-upload-label">
          <div class="file-upload-icon">📁</div>
          <div class="file-upload-text">
            Excel 파일을 선택<br>
            <small>(.xls, .xlsx 파일만 지원)</small>
          </div>
        </label>
      </div>

      <div class="button-group">
        <button type="button" class="btn-secondary demo-button" onclick="previewMail()">미리보기</button>
        <button type="submit" class="btn-primary">발송하기</button>
      </div>
      <div class="progress-wrapper">
        <div class="progress-info">
          <div class="progress-text">
            <span class="status-dot"></span>
            메일 발송 진행 상황
          </div>
          <div id="progressDisplay" class="progress-count">
            0 / -
          </div>
        </div>
        <div class="progress-bar-container">
          <div id="progressBar" class="progress-bar"></div>
        </div>
      </div>
    </form>
    <div id="result"></div>
  </div>
</div>

<!-- 모달 -->
<div class="modal-overlay" id="previewModal" onclick="closeModalOnOverlay()">
  <div class="modal-container">
    <div class="modal-header">
      <div>
        <div class="modal-title" style="margin-bottom: 10px;">
          <span>📧</span>
          <span>미리보기</span>
        </div>
        <div class="total-count" id="totalCountDisplay">
          총 0명에게 발송 예정
        </div>
      </div>
      <button class="modal-close" onclick="closePreviewModal()">
        ×
      </button>
    </div>
    <div class="modal-body" id="modalContent">
    </div>
  </div>
</div>
<script src="quill-editor.js"></script>
<script src="mail-section.js"></script>
<script src="template-section.js"></script>
<script src="../global.js"></script>
</body>
</html>